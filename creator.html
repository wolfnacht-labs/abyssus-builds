<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Build Creator - Abyssus Builds</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #0f0f0f;
            color: white;
        }

        .navbar {
            background-color: #000;
            border-bottom: 3px solid #059669;
            padding: 0;
            display: flex;
            align-items: center;
            height: 80px;
        }

        .logo {
            padding: 0 30px;
            font-size: 24px;
            font-weight: bold;
            color: #059669;
        }

        .nav-links {
            display: flex;
            gap: 0;
            height: 100%;
            margin-left: 20px;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            padding: 0 40px;
            display: flex;
            align-items: center;
            font-size: 18px;
            height: 100%;
            transition: background-color 0.3s;
        }

        .nav-links a:hover, .nav-links a.active {
            background-color: #1a1a1a;
        }

        .creator-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #059669;
        }

        .form-section {
            background-color: #1A1A1A;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .input-group {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }

        input[type="text"], select, textarea {
            background-color: #2C3539;
            color: white;
            border: 1px solid #444;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
        }

        input[type="text"]:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #059669;
        }

        .build-content {
            display: flex;
            gap: 15px;
        }

        .weapon-column {
            flex: 2;
        }

        .ability-column {
            flex: 1;
        }

        .section-header {
            background-color: #2C3539;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            margin-bottom: 10px;
            border-radius: 4px;
        }

        .form-row {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .form-col {
            flex: 1;
        }

        .form-col label {
            display: block;
            background-color: #2C3539;
            padding: 8px;
            text-align: center;
            font-weight: bold;
            border-radius: 4px;
            margin-bottom: 5px;
        }

        .form-col select {
            width: 100%;
        }

        .forge-section {
            margin-top: 20px;
        }

        .forge-item {
            margin-bottom: 8px;
        }

        .charms-row {
            display: flex;
            gap: 10px;
        }

        textarea {
            width: 100%;
            height: 80px;
            resize: vertical;
        }

        .submit-btn {
            background-color: #059669;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 6px;
            cursor: pointer;
            display: block;
            margin: 20px auto;
        }

        .submit-btn:hover {
            background-color: #047857;
        }

        .submit-btn:disabled {
            background-color: #666;
            cursor: not-allowed;
        }

        .success-message {
            background-color: #059669;
            color: white;
            padding: 15px;
            border-radius: 4px;
            text-align: center;
            margin: 20px 0;
            display: none;
        }

        .error-message {
            background-color: #dc2626;
            color: white;
            padding: 15px;
            border-radius: 4px;
            text-align: center;
            margin: 20px 0;
            display: none;
        }

        .select-with-icon {
            position: relative;
            display: block;
        }

        .selected-icon {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            object-fit: contain;
            pointer-events: none;
            display: none;
            z-index: 1;
        }

        .select-with-icon select {
            padding-left: 38px;
        }
    </style>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyCBpZluc0v2dxu1GhgQv8SucSKwmM2ESdU",
            authDomain: "abyssus-builds.firebaseapp.com",
            projectId: "abyssus-builds",
            storageBucket: "abyssus-builds.firebasestorage.app",
            messagingSenderId: "139945292825",
            appId: "1:139945292825:web:f730c55dded04e689fa688"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.db = db;
        window.firestore = { collection, addDoc };
    </script>
</head>
<body>
    <nav class="navbar">
        <div class="logo">
            <img src="abyssus_builds.png" alt="Abyssus Builds" style="height: 50px;">
        </div>
        <div class="nav-links">
            <a href="index.html">Builds</a>
            <a href="creator.html" class="active">Build Creator</a>
        </div>
    </nav>

    <div class="creator-container">
        <h1>Create Your Build</h1>
        
        <div id="successMessage" class="success-message">
            Build created successfully! <a href="index.html" style="color: white; text-decoration: underline;">View all builds</a>
        </div>

        <div id="errorMessage" class="error-message"></div>

        <div class="form-section">
            <div class="input-group">
                <input type="text" id="buildName" placeholder="Build Name" style="width: 400px;">
                <span style="color: white; font-size: 16px; margin: 0 5px;">@</span>
                <input type="text" id="authorName" placeholder="Author Name" style="width: 300px;">
            </div>
        </div>

        <div class="form-section">
            <div class="build-content">
                <div class="weapon-column">
                    <div class="section-header">Weapon</div>
                    <div class="select-with-icon" style="margin-bottom: 15px;">
                        <img id="weaponIcon" class="selected-icon" src="" alt="">
                        <select id="weaponSelect" style="width: 100%;" onchange="updateWeaponIcon()">
                            <option value="">Select Weapon</option>
                            <option value="Engine Rifle">Engine Rifle</option>
                            <option value="Shotgun">Shotgun</option>
                            <option value="Tesla Gun">Tesla Gun</option>
                            <option value="Brine Revolver">Brine Revolver</option>
                            <option value="Disc Thrower">Disc Thrower</option>
                            <option value="Combat Bow">Combat Bow</option>
                            <option value="Plasma Launcher">Plasma Launcher</option>
                            <option value="Fish Deity">Fish Deity</option>
                        </select>
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <label>Primary</label>
                            <div class="select-with-icon">
                                <img id="primaryIcon" class="selected-icon" src="" alt="">
                                <select id="primarySelect" style="width: 100%;" onchange="updatePrimaryIcon()">
                                    <option value="">Select Primary</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-col">
                            <label>Secondary</label>
                            <div class="select-with-icon">
                                <img id="secondaryIcon" class="selected-icon" src="" alt="">
                                <select id="secondarySelect" style="width: 100%;" onchange="updateSecondaryIcon()">
                                    <option value="">Select Secondary</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <label>Aspect</label>
                            <div class="select-with-icon">
                                <img id="aspect1Icon" class="selected-icon" src="" alt="">
                                <select id="aspect1" style="width: 100%;" onchange="updateAspectOptions(); updateAspectIcons()">
                                    <option value="">Select Aspect</option>
                                    <option value="Blood">Blood</option>
                                    <option value="Barrier">Barrier</option>
                                    <option value="Flares">Flares</option>
                                    <option value="Goldburst">Goldburst</option>
                                    <option value="Frozen">Frozen</option>
                                    <option value="Chain Lightning">Chain Lightning</option>
                                    <option value="Shadows">Shadows</option>
                                    <option value="Tentacles">Tentacles</option>
                                    <option value="Spirit">Spirit</option>
                                    <option value="Windburst">Windburst</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-col">
                            <label>Aspect</label>
                            <div class="select-with-icon">
                                <img id="aspect2Icon" class="selected-icon" src="" alt="">
                                <select id="aspect2" style="width: 100%;" onchange="updateAspectOptions(); updateAspectIcons()">
                                    <option value="">Select Aspect</option>
                                    <option value="Blood">Blood</option>
                                    <option value="Barrier">Barrier</option>
                                    <option value="Flares">Flares</option>
                                    <option value="Goldburst">Goldburst</option>
                                    <option value="Frozen">Frozen</option>
                                    <option value="Chain Lightning">Chain Lightning</option>
                                    <option value="Shadows">Shadows</option>
                                    <option value="Tentacles">Tentacles</option>
                                    <option value="Spirit">Spirit</option>
                                    <option value="Windburst">Windburst</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="forge-section">
                        <div class="section-header">Forge Upgrades</div>
                        <div class="forge-item">
                            <div class="select-with-icon">
                                <img id="weaponForge1Icon" class="selected-icon" src="" alt="">
                                <select id="weaponForge1" style="width: 100%;" onchange="updateWeaponForgeIcons(); updateForgeAvailability()">
                                    <option value="">Forge Upgrade #1</option>
                                </select>
                            </div>
                        </div>
                        <div class="forge-item">
                            <div class="select-with-icon">
                                <img id="weaponForge2Icon" class="selected-icon" src="" alt="">
                                <select id="weaponForge2" style="width: 100%;" onchange="updateWeaponForgeIcons(); updateForgeAvailability()">
                                    <option value="">Forge Upgrade #2</option>
                                </select>
                            </div>
                        </div>
                        <div class="forge-item">
                            <div class="select-with-icon">
                                <img id="weaponForge3Icon" class="selected-icon" src="" alt="">
                                <select id="weaponForge3" style="width: 100%;" onchange="updateWeaponForgeIcons(); updateForgeAvailability()">
                                    <option value="">Forge Upgrade #3</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="ability-column">
                    <div class="section-header">Ability</div>
                    <div class="select-with-icon" style="margin-bottom: 15px;">
                        <img id="abilityIcon" class="selected-icon" src="" alt="">
                        <select id="abilitySelect" style="width: 100%;" onchange="updateAbilityIcon()">
                            <option value="">Select Ability</option>
                            <option value="Frag Grenade">Frag Grenade</option>
                            <option value="Anchor">Anchor</option>
                            <option value="Ancient Core">Ancient Core</option>
                            <option value="Brine Field">Brine Field</option>
                            <option value="Turret">Turret</option>
                        </select>
                    </div>

                    <div style="height: 75px; margin-bottom: 15px;"></div>

                    <div style="margin-bottom: 15px;">
                        <label style="display: block; background-color: #2C3539; padding: 8px; text-align: center; font-weight: bold; border-radius: 4px; margin-bottom: 5px;">Aspect</label>
                        <div class="select-with-icon">
                            <img id="aspect3Icon" class="selected-icon" src="" alt="">
                            <select id="aspect3" style="width: 100%;" onchange="updateAspectOptions(); updateAspectIcons()">
                                <option value="">Select Aspect</option>
                                <option value="Blood">Blood</option>
                                <option value="Barrier">Barrier</option>
                                <option value="Flares">Flares</option>
                                <option value="Goldburst">Goldburst</option>
                                <option value="Frozen">Frozen</option>
                                <option value="Chain Lightning">Chain Lightning</option>
                                <option value="Shadows">Shadows</option>
                                <option value="Tentacles">Tentacles</option>
                                <option value="Spirit">Spirit</option>
                                <option value="Windburst">Windburst</option>
                            </select>
                        </div>
                    </div>

                    <div class="forge-section">
                        <div class="section-header">Forge Upgrades</div>
                        <div class="forge-item">
                            <div class="select-with-icon">
                                <img id="abilityForge1Icon" class="selected-icon" src="" alt="">
                                <select id="abilityForge1" style="width: 100%;" onchange="updateAbilityForgeIcons(); updateForgeAvailability()">
                                    <option value="">Forge Upgrade #1</option>
                                </select>
                            </div>
                        </div>
                        <div class="forge-item">
                            <div class="select-with-icon">
                                <img id="abilityForge2Icon" class="selected-icon" src="" alt="">
                                <select id="abilityForge2" style="width: 100%;" onchange="updateAbilityForgeIcons(); updateForgeAvailability()">
                                    <option value="">Forge Upgrade #2</option>
                                </select>
                            </div>
                        </div>
                        <div class="forge-item">
                            <div class="select-with-icon">
                                <img id="abilityForge3Icon" class="selected-icon" src="" alt="">
                                <select id="abilityForge3" style="width: 100%;" onchange="updateAbilityForgeIcons(); updateForgeAvailability()">
                                    <option value="">Forge Upgrade #3</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="form-section">
            <div class="section-header">Charms</div>
            <div class="charms-row">
                <div class="select-with-icon" style="flex: 1; margin-right: 10px;">
                    <img id="charm1Icon" class="selected-icon" src="" alt="">
                    <select id="charm1" style="width: 100%;" onchange="updateCharmOptions(); updateCharmIcons()">
                        <option value="">Select Charm</option>
                        <option value="Hawkeye">Hawkeye</option>
                        <option value="Gun Meets Face">Gun Meets Face</option>
                        <option value="Activate Gun Mode">Activate Gun Mode</option>
                        <option value="Hate Forged">Hate Forged</option>
                        <option value="Supersonic">Supersonic</option>
                        <option value="Power From Pain">Power From Pain</option>
                        <option value="Golden Ticket">Golden Ticket</option>
                        <option value="Fan">Fan</option>
                        <option value="Ms. Boom">Ms. Boom</option>
                        <option value="Mr. Boom">Mr. Boom</option>
                        <option value="Gold Lure">Gold Lure</option>
                        <option value="Freebie">Freebie</option>
                        <option value="Bandage">Bandage</option>
                        <option value="Phoenix Feather">Phoenix Feather</option>
                        <option value="Perfectionist">Perfectionist</option>
                        <option value="Durable">Durable</option>
                        <option value="Consistent Killer">Consistent Killer</option>
                        <option value="Piercing Rounds">Piercing Rounds</option>
                        <option value="Assassination">Assassination</option>
                        <option value="Violent Commitment">Violent Commitment</option>
                        <option value="Healthy Commitment">Healthy Commitment</option>
                        <option value="Slow Power">Slow Power</option>
                        <option value="Upgrade Kit">Upgrade Kit</option>
                        <option value="Gold Converter">Gold Converter</option>
                        <option value="Marksman">Marksman</option>
                        <option value="Skeleton Key">Skeleton Key</option>
                        <option value="Overkill">Overkill</option>
                        <option value="Giant Slayer">Giant Slayer</option>
                        <option value="Headstart">Headstart</option>
                        <option value="Favored Foe">Favored Foe</option>
                        <option value="Lifeline">Lifeline</option>
                        <option value="Overdrive">Overdrive</option>
                        <option value="Lucky Charm">Lucky Charm</option>
                        <option value="Revenant">Revenant</option>
                        <option value="Hex">Hex</option>
                        <option value="Backline">Backline</option>
                        <option value="Thief's Eye">Thief's Eye</option>
                        <option value="Blessed">Blessed</option>
                        <option value="Spiritual">Spiritual</option>
                        <option value="Productive">Productive</option>
                    </select>
                </div>
                <div class="select-with-icon" style="flex: 1;">
                    <img id="charm2Icon" class="selected-icon" src="" alt="">
                    <select id="charm2" style="width: 100%;" onchange="updateCharmOptions(); updateCharmIcons()">
                        <option value="">Select Charm</option>
                        <option value="Hawkeye">Hawkeye</option>
                        <option value="Gun Meets Face">Gun Meets Face</option>
                        <option value="Activate Gun Mode">Activate Gun Mode</option>
                        <option value="Hate Forged">Hate Forged</option>
                        <option value="Supersonic">Supersonic</option>
                        <option value="Power From Pain">Power From Pain</option>
                        <option value="Golden Ticket">Golden Ticket</option>
                        <option value="Fan">Fan</option>
                        <option value="Ms. Boom">Ms. Boom</option>
                        <option value="Mr. Boom">Mr. Boom</option>
                        <option value="Gold Lure">Gold Lure</option>
                        <option value="Freebie">Freebie</option>
                        <option value="Bandage">Bandage</option>
                        <option value="Phoenix Feather">Phoenix Feather</option>
                        <option value="Perfectionist">Perfectionist</option>
                        <option value="Durable">Durable</option>
                        <option value="Consistent Killer">Consistent Killer</option>
                        <option value="Piercing Rounds">Piercing Rounds</option>
                        <option value="Assassination">Assassination</option>
                        <option value="Violent Commitment">Violent Commitment</option>
                        <option value="Healthy Commitment">Healthy Commitment</option>
                        <option value="Slow Power">Slow Power</option>
                        <option value="Upgrade Kit">Upgrade Kit</option>
                        <option value="Gold Converter">Gold Converter</option>
                        <option value="Marksman">Marksman</option>
                        <option value="Skeleton Key">Skeleton Key</option>
                        <option value="Overkill">Overkill</option>
                        <option value="Giant Slayer">Giant Slayer</option>
                        <option value="Headstart">Headstart</option>
                        <option value="Favored Foe">Favored Foe</option>
                        <option value="Lifeline">Lifeline</option>
                        <option value="Overdrive">Overdrive</option>
                        <option value="Lucky Charm">Lucky Charm</option>
                        <option value="Revenant">Revenant</option>
                        <option value="Hex">Hex</option>
                        <option value="Backline">Backline</option>
                        <option value="Thief's Eye">Thief's Eye</option>
                        <option value="Blessed">Blessed</option>
                        <option value="Spiritual">Spiritual</option>
                        <option value="Productive">Productive</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="form-section">
            <div class="section-header">Description</div>
            <textarea id="description" placeholder="Here should be a short description."></textarea>
        </div>

        <button class="submit-btn" id="submitBtn" onclick="addBuild()">Add Build</button>
    </div>

    <script>
        // Icon mappings
        const weaponIcons = {
            'Engine Rifle': 'images/weapons/Engine_Rifle_Icon.png',
            'Shotgun': 'images/weapons/Shotgun_Icon.png',
            'Tesla Gun': 'images/weapons/Tesla_Gun_Icon.png',
            'Brine Revolver': 'images/weapons/Brine_Revolver_Icon.png',
            'Disc Thrower': 'images/weapons/Disc_Thrower_Icon.png',
            'Combat Bow': 'images/weapons/Combat_Bow_Icon.png',
            'Plasma Launcher': 'images/weapons/Plasma_Launcher_Icon.png',
            'Fish Deity': 'images/weapons/Fish_Deity_Icon.png'
        };

        const abilityIcons = {
            'Frag Grenade': 'images/abilities/Frag_Grenade_Icon.png',
            'Anchor': 'images/abilities/Anchor_Icon.png',
            'Ancient Core': 'images/abilities/Ancient_Core_Icon.png',
            'Brine Field': 'images/abilities/Brine_Field_Icon.png',
            'Turret': 'images/abilities/Turret_Icon.png'
        };

        const aspectIcons = {
            'Blood': 'images/aspects/Blood_Icon.png',
            'Barrier': 'images/aspects/Barrier_Icon.png',
            'Flares': 'images/aspects/Flares_Icon.png',
            'Goldburst': 'images/aspects/Goldburst_Icon.png',
            'Frozen': 'images/aspects/Frozen_Icon.png',
            'Chain Lightning': 'images/aspects/Chain_Lightning_Icon.png',
            'Shadows': 'images/aspects/Shadows_Icon.png',
            'Tentacles': 'images/aspects/Tentacles_Icon.png',
            'Spirit': 'images/aspects/Spirit_Icon.png',
            'Windburst': 'images/aspects/Windburst_Icon.png'
        };

        const charmIcons = {
            'Hawkeye': 'images/charms/Charm_Common_Icon.png',
            'Gun Meets Face': 'images/charms/Charm_Common_Icon.png',
            'Activate Gun Mode': 'images/charms/Charm_Common_Icon.png',
            'Hate Forged': 'images/charms/Charm_Common_Icon.png',
            'Supersonic': 'images/charms/Charm_Common_Icon.png',
            'Power From Pain': 'images/charms/Charm_Rare_Icon.png',
            'Golden Ticket': 'images/charms/Charm_Legendary_Icon.png',
            'Fan': 'images/charms/Charm_Legendary_Icon.png',
            'Ms. Boom': 'images/charms/Charm_Rare_Icon.png',
            'Mr. Boom': 'images/charms/Charm_Legendary_Icon.png',
            'Gold Lure': 'images/charms/Charm_Legendary_Icon.png',
            'Freebie': 'images/charms/Charm_Legendary_Icon.png',
            'Bandage': 'images/charms/Charm_Rare_Icon.png',
            'Phoenix Feather': 'images/charms/Charm_Legendary_Icon.png',
            'Perfectionist': 'images/charms/Charm_Common_Icon.png',
            'Durable': 'images/charms/Charm_Common_Icon.png',
            'Consistent Killer': 'images/charms/Charm_Common_Icon.png',
            'Piercing Rounds': 'images/charms/Charm_Common_Icon.png',
            'Assassination': 'images/charms/Charm_Common_Icon.png',
            'Violent Commitment': 'images/charms/Charm_Rare_Icon.png',
            'Healthy Commitment': 'images/charms/Charm_Common_Icon.png',
            'Slow Power': 'images/charms/Charm_Rare_Icon.png',
            'Upgrade Kit': 'images/charms/Charm_Legendary_Icon.png',
            'Gold Converter': 'images/charms/Charm_Rare_Icon.png',
            'Marksman': 'images/charms/Charm_Common_Icon.png',
            'Skeleton Key': 'images/charms/Charm_Legendary_Icon.png',
            'Overkill': 'images/charms/Charm_Legendary_Icon.png',
            'Giant Slayer': 'images/charms/Charm_Common_Icon.png',
            'Headstart': 'images/charms/Charm_Common_Icon.png',
            'Favored Foe': 'images/charms/Charm_Rare_Icon.png',
            'Lifeline': 'images/charms/Charm_Common_Icon.png',
            'Overdrive': 'images/charms/Charm_Common_Icon.png',
            'Lucky Charm': 'images/charms/Charm_Rare_Icon.png',
            'Revenant': 'images/charms/Charm_Rare_Icon.png',
            'Hex': 'images/charms/Charm_Rare_Icon.png',
            'Backline': 'images/charms/Charm_Common_Icon.png',
            "Thief's Eye": 'images/charms/Charm_Legendary_Icon.png',
            'Blessed': 'images/charms/Charm_Rare_Icon.png',
            'Spiritual': 'images/charms/Charm_Legendary_Icon.png',
            'Productive': 'images/charms/Charm_Common_Icon.png'
        };

        const primaryIcons = {
            'Automatic Fire': 'images/primaries/Automatic_Fire.png',
            'Burst Fire': 'images/primaries/Burst_Fire.png',
            'Gatling Fire': 'images/primaries/Gatling_Fire.png',
            'Semi-automatic': 'images/primaries/Semi-automatic.png',
            'Full-automatic': 'images/primaries/Full-automatic.png',
            'Superheavy Slug': 'images/primaries/Superheavy_Slug.png',
            'Electrical Beam': 'images/primaries/Electrical_Beam.png',
            'Charge Beam': 'images/primaries/Charge_Beam.png',
            'Unstable Coil': 'images/primaries/Unstable_Coil.png',
            'Large Caliber': 'images/primaries/Large_Caliber.png',
            'Automatic': 'images/primaries/Automatic.png',
            'Fan Fire': 'images/primaries/Fan_Fire.png',
            'Dynamo': 'images/primaries/Dynamo.png',
            'Precision Shot': 'images/primaries/Precision_Shot.png',
            'Pierce': 'images/primaries/Pierce.png',
            'Return Arrow': 'images/primaries/Return_Arrow.png',
            'Flak Cannon': 'images/primaries/Flak_Cannon.png',
            'Seekers': 'images/primaries/Seekers.png',
            'Rapid Goo': 'images/primaries/Rapid_Goo.png',
            'Fish Spit': 'images/primaries/Fish_Spit.png',
            'Hazardous Goo': 'images/primaries/Hazardous_Goo.png'
        };

        const getPrimaryIcon = (weapon, primary) => {
            if (weapon === 'Brine Revolver') {
                if (primary === 'Semi-automatic') return 'images/primaries/Semi-automatic_Revolver.png';
                if (primary === 'Burst Fire') return 'images/primaries/Burst_Fire_Revolver.png';
            }
            if (weapon === 'Shotgun' && primary === 'Semi-automatic') {
                return 'images/primaries/Semi-automatic_Shotgun.png';
            }
            return primaryIcons[primary];
        };

        const secondaryIcons = {
            'Engine Rev': 'images/secondaries/Engine_Rev.png',
            'Split Shot': 'images/secondaries/Split_Shot.png',
            'Concentrated Shot': 'images/secondaries/Concentrated_Shot.png',
            'Buckshot': 'images/secondaries/Buckshot.png',
            'Unload': 'images/secondaries/Unload.png',
            'Pressure Shot': 'images/secondaries/Pressure_Shot.png',
            'Spark Orb': 'images/secondaries/Spark_Orb.png',
            'Charge Orb': 'images/secondaries/Charge_Orb.png',
            'Magnetic Storm': 'images/secondaries/Magnetic_Storm.png',
            'Steady Scope': 'images/secondaries/Steady_Scope.png',
            'Quick Scope': 'images/secondaries/Quick_Scope.png',
            'Charge Scope': 'images/secondaries/Charge_Scope.png',
            'Inferno Discs': 'images/secondaries/Inferno_Discs.png',
            'Electron Conductors': 'images/secondaries/Electron_Conductors.png',
            'Search and Destroy': 'images/secondaries/Search_and_Destroy.png',
            'Multi-Shot': 'images/secondaries/Multi-Shot.png',
            'Smart Arrow': 'images/secondaries/Smart_Arrow.png',
            'Exploding Arrow': 'images/secondaries/Exploding_Arrow.png',
            'Disintegration Beam': 'images/secondaries/Disintegration_Beam.png',
            'Void Infusion': 'images/secondaries/Void_Infusion.png',
            'Adhesive Compound': 'images/secondaries/Adhesive_Compound.png',
            'Piercing Stab': 'images/secondaries/Piercing_Stab.png',
            'Wide Stab': 'images/secondaries/Wide_Stab.png',
            'Chainsaw': 'images/secondaries/Chainsaw.png'
        };

        const weaponPrimaries = {
            'Engine Rifle': ['Automatic Fire', 'Burst Fire', 'Gatling Fire'],
            'Shotgun': ['Semi-automatic', 'Full-automatic', 'Superheavy Slug'],
            'Tesla Gun': ['Electrical Beam', 'Charge Beam', 'Unstable Coil'],
            'Brine Revolver': ['Semi-automatic', 'Burst Fire', 'Large Caliber'],
            'Disc Thrower': ['Automatic', 'Fan Fire', 'Dynamo'],
            'Combat Bow': ['Precision Shot', 'Pierce', 'Return Arrow'],
            'Plasma Launcher': ['Semi-automatic', 'Flak Cannon', 'Seekers'],
            'Fish Deity': ['Rapid Goo', 'Fish Spit', 'Hazardous Goo']
        };

        const weaponSecondaries = {
            'Engine Rifle': ['Engine Rev', 'Split Shot', 'Concentrated Shot'],
            'Shotgun': ['Buckshot', 'Unload', 'Pressure Shot'],
            'Tesla Gun': ['Spark Orb', 'Charge Orb', 'Magnetic Storm'],
            'Brine Revolver': ['Steady Scope', 'Quick Scope', 'Charge Scope'],
            'Disc Thrower': ['Inferno Discs', 'Electron Conductors', 'Search and Destroy'],
            'Combat Bow': ['Multi-Shot', 'Smart Arrow', 'Exploding Arrow'],
            'Plasma Launcher': ['Disintegration Beam', 'Void Infusion', 'Adhesive Compound'],
            'Fish Deity': ['Piercing Stab', 'Wide Stab', 'Chainsaw']
        };

        const sharedAbilityForges = [
            'Extra Pockets', 'Increased Efficiency', 'Rich Get Richer', 'Investment', 'Double Trouble'
        ];

        const abilityForgeUpgrades = {
            'Frag Grenade': [
                ...sharedAbilityForges,
                'Exposure Blast', 'Domino', 'Explosive Culling', 'Implosive Force', 'Cluster Bomb',
                'Compact Grenade', 'Shrapnel', 'Bouncy Bomb', 'Gas Grenade', 'Gashing Shell', 'Sharp Shell'
            ],
            'Anchor': [
                ...sharedAbilityForges,
                'Self-sustaining', 'The Thrill', 'Grenanchor', 'Brine', 'Bulwark',
                'Fearless', 'Anchored', 'Bonebreaker', 'Mighty', 'Geyser', 'Death Slam'
            ],
            'Ancient Core': [
                ...sharedAbilityForges,
                'Cone Blast', 'Gold Blast', 'Stun Blast', 'Bounce Blast', 'Active Reload',
                'Target Lock', "Hunter's Mark", 'Laser Sight', 'Death Strike', 'Trigger Happy', 'Explosive Blast'
            ],
            'Brine Field': [
                ...sharedAbilityForges,
                'Quality Over Quantity', 'Personal Space', 'Safety Dance', 'Lingering Field', 'Steady Field',
                'Mobility Field', 'End With a Bang!', 'Time Warp', 'Noxious Bubble', 'Expanding Territory', 'Sanctum'
            ],
            'Turret': [
                ...sharedAbilityForges,
                'Sniper Mode', 'Drones', 'Ammo Transfer', 'Buddy System', 'Unstable Cores',
                'Sentinel', 'Persistent', 'Spiked Ammunition', 'Guiding Bullet', 'Teamwork', 'Ricochet'
            ]
        };

        const getAbilityForgeIcon = (ability, forge) => {
            if (sharedAbilityForges.includes(forge)) {
                return 'images/forgeupgrades/Shared_Forge.png';
            }
            const abilityIconMap = {
                'Frag Grenade': 'images/forgeupgrades/Frag_Grenade_Forge.png',
                'Anchor': 'images/forgeupgrades/Anchor_Forge.png',
                'Ancient Core': 'images/forgeupgrades/Ancient_Core_Forge.png',
                'Brine Field': 'images/forgeupgrades/Brine_Field_Forge.png',
                'Turret': 'images/forgeupgrades/Turret_Forge.png'
            };
            return abilityIconMap[ability];
        };

        const weaponForgeUpgrades = {
            'Engine Rifle': [
                'Prolonged Revving', 'Greased Barrel', 'Insulated Barrel', 'Heat Converter',
                'Binary Cooling', 'Burst Cooling', 'Large Capacity', 'Heat Expulsion'
            ],
            'Shotgun': [
                'Light Frame', 'Long Barrel', 'Sawed-Off Barrel', 'Heavy Shell',
                'Compact Shell', 'Optimized Gauge', 'Automatic Trigger', 'Automatic Action'
            ],
            'Tesla Gun': [
                'Spark Gap', 'Streamlined Transistor', 'Compact Transformer', 'Larger Battery',
                'Wireless Transmitter', 'High Voltage', 'High-Frequency', 'Backup Battery'
            ],
            'Brine Revolver': [
                'Combustion Muzzle', 'Critical Cylinder', 'Fast Trigger', 'Critical Bullets',
                'Accelerating Bullets', 'Overload Bullets', 'Boosted Cylinder', 'Exploitative Bullets'
            ],
            'Disc Thrower': [
                'Spare Discs', 'Slim Discs', 'Twin Discs', 'Whetting Bounce',
                'Elemental Overcharge', 'Halting Discs', 'Automatic Detonation', 'Priming Flight'
            ],
            'Combat Bow': [
                'Pressure Arrow', 'Stable String', 'Elastic String', 'True Form',
                'Consistent Scope', 'Spined Arrow', 'Longbow', 'Shortbow'
            ],
            'Plasma Launcher': [
                'Seismic Fuel', 'Molotov Fuel', 'Revolving Valve', 'Explosive Valve',
                'Accelerating Core', 'Bouncy Core', 'Spreading Heat', 'Repeating Blasts'
            ],
            'Fish Deity': [
                'Discharging Reload', 'Elastic Goo', 'Softening Acid', 'Weakening Jabs',
                'Repeating Jabs', 'Pursuing Horn', 'Long Horn', 'Stunning Strike'
            ]
        };

        const getWeaponForgeIcon = (weapon) => {
            const weaponIconMap = {
                'Engine Rifle': 'images/forgeupgrades/Engine_Rifle_Forge.png',
                'Shotgun': 'images/forgeupgrades/Shotgun_Forge.png',
                'Tesla Gun': 'images/forgeupgrades/Tesla_Gun_Forge.png',
                'Brine Revolver': 'images/forgeupgrades/Brine_Revolver_Forge.png',
                'Disc Thrower': 'images/forgeupgrades/Disc_Thrower_Forge.png',
                'Combat Bow': 'images/forgeupgrades/Combat_Bow_Forge.png',
                'Plasma Launcher': 'images/forgeupgrades/Plasma_Launcher_Forge.png',
                'Fish Deity': 'images/forgeupgrades/Fish_Deity_Forge.png'
            };
            return weaponIconMap[weapon];
        };

        function updateWeaponIcon() {
            const weapon = document.getElementById('weaponSelect').value;
            const icon = document.getElementById('weaponIcon');
            if (weapon && weaponIcons[weapon]) {
                icon.src = weaponIcons[weapon];
                icon.style.display = 'block';
            } else {
                icon.style.display = 'none';
            }

            const primarySelect = document.getElementById('primarySelect');
            const primaryIcon = document.getElementById('primaryIcon');
            primarySelect.innerHTML = '<option value="">Select Primary</option>';
            primaryIcon.style.display = 'none';

            if (weapon && weaponPrimaries[weapon]) {
                weaponPrimaries[weapon].forEach(primary => {
                    const option = document.createElement('option');
                    option.value = primary;
                    option.textContent = primary;
                    primarySelect.appendChild(option);
                });
            }

            const secondarySelect = document.getElementById('secondarySelect');
            const secondaryIcon = document.getElementById('secondaryIcon');
            secondarySelect.innerHTML = '<option value="">Select Secondary</option>';
            secondaryIcon.style.display = 'none';

            if (weapon && weaponSecondaries[weapon]) {
                weaponSecondaries[weapon].forEach(secondary => {
                    const option = document.createElement('option');
                    option.value = secondary;
                    option.textContent = secondary;
                    secondarySelect.appendChild(option);
                });
            }

            const forgeSelects = ['weaponForge1', 'weaponForge2', 'weaponForge3'];
            forgeSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                const icon = document.getElementById(selectId + 'Icon');
                const currentValue = select.value;
                select.innerHTML = '<option value="">Forge Upgrade #' + selectId.slice(-1) + '</option>';
                icon.style.display = 'none';

                if (weapon && weaponForgeUpgrades[weapon]) {
                    weaponForgeUpgrades[weapon].forEach(forge => {
                        const option = document.createElement('option');
                        option.value = forge;
                        option.textContent = forge;
                        select.appendChild(option);
                    });
                }
            });

            updateForgeAvailability();
        }

        function updateWeaponForgeIcons() {
            const weapon = document.getElementById('weaponSelect').value;
            ['weaponForge1', 'weaponForge2', 'weaponForge3'].forEach(id => {
                const forge = document.getElementById(id).value;
                const icon = document.getElementById(id + 'Icon');
                if (forge && weapon) {
                    const iconPath = getWeaponForgeIcon(weapon);
                    if (iconPath) {
                        icon.src = iconPath;
                        icon.style.display = 'block';
                    } else {
                        icon.style.display = 'none';
                    }
                } else {
                    icon.style.display = 'none';
                }
            });

            const selectedWeaponForges = [
                document.getElementById('weaponForge1').value,
                document.getElementById('weaponForge2').value,
                document.getElementById('weaponForge3').value
            ].filter(v => v !== '');

            ['weaponForge1', 'weaponForge2', 'weaponForge3'].forEach(selectId => {
                const select = document.getElementById(selectId);
                const options = select.querySelectorAll('option');
                options.forEach(option => {
                    if (option.value !== '' && selectedWeaponForges.includes(option.value) && select.value !== option.value) {
                        option.disabled = true;
                    } else {
                        option.disabled = false;
                    }
                });
            });
        }

        function updatePrimaryIcon() {
            const weapon = document.getElementById('weaponSelect').value;
            const primary = document.getElementById('primarySelect').value;
            const icon = document.getElementById('primaryIcon');
            if (primary) {
                const iconPath = getPrimaryIcon(weapon, primary);
                if (iconPath) {
                    icon.src = iconPath;
                    icon.style.display = 'block';
                } else {
                    icon.style.display = 'none';
                }
            } else {
                icon.style.display = 'none';
            }
        }

        function updateSecondaryIcon() {
            const secondary = document.getElementById('secondarySelect').value;
            const icon = document.getElementById('secondaryIcon');
            if (secondary && secondaryIcons[secondary]) {
                icon.src = secondaryIcons[secondary];
                icon.style.display = 'block';
            } else {
                icon.style.display = 'none';
            }
        }

        function updateAbilityIcon() {
            const ability = document.getElementById('abilitySelect').value;
            const icon = document.getElementById('abilityIcon');
            if (ability && abilityIcons[ability]) {
                icon.src = abilityIcons[ability];
                icon.style.display = 'block';
            } else {
                icon.style.display = 'none';
            }

            const forgeSelects = ['abilityForge1', 'abilityForge2', 'abilityForge3'];
            forgeSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                const icon = document.getElementById(selectId + 'Icon');
                select.innerHTML = '<option value="">Forge Upgrade #' + selectId.slice(-1) + '</option>';
                icon.style.display = 'none';

                if (ability && abilityForgeUpgrades[ability]) {
                    abilityForgeUpgrades[ability].forEach(forge => {
                        const option = document.createElement('option');
                        option.value = forge;
                        option.textContent = forge;
                        select.appendChild(option);
                    });
                }
            });
        }

        function updateAbilityForgeIcons() {
            const ability = document.getElementById('abilitySelect').value;
            ['abilityForge1', 'abilityForge2', 'abilityForge3'].forEach(id => {
                const forge = document.getElementById(id).value;
                const icon = document.getElementById(id + 'Icon');
                if (forge && ability) {
                    const iconPath = getAbilityForgeIcon(ability, forge);
                    if (iconPath) {
                        icon.src = iconPath;
                        icon.style.display = 'block';
                    } else {
                        icon.style.display = 'none';
                    }
                } else {
                    icon.style.display = 'none';
                }
            });

            const selectedAbilityForges = [
                document.getElementById('abilityForge1').value,
                document.getElementById('abilityForge2').value,
                document.getElementById('abilityForge3').value
            ].filter(v => v !== '');

            ['abilityForge1', 'abilityForge2', 'abilityForge3'].forEach(selectId => {
                const select = document.getElementById(selectId);
                const options = select.querySelectorAll('option');
                options.forEach(option => {
                    if (option.value !== '' && selectedAbilityForges.includes(option.value) && select.value !== option.value) {
                        option.disabled = true;
                    } else {
                        option.disabled = false;
                    }
                });
            });
        }

        function updateForgeAvailability() {
            const allForgeSelects = [
                'weaponForge1', 'weaponForge2', 'weaponForge3',
                'abilityForge1', 'abilityForge2', 'abilityForge3'
            ];

            const selectedForges = allForgeSelects.map(id => document.getElementById(id).value).filter(v => v !== '');
            const selectedCount = selectedForges.length;

            allForgeSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select.value === '' && selectedCount >= 3) {
                    select.disabled = true;
                    select.style.opacity = '0.5';
                    select.style.cursor = 'not-allowed';
                } else {
                    select.disabled = false;
                    select.style.opacity = '1';
                    select.style.cursor = 'pointer';
                }
            });
        }

        function updateAspectIcons() {
            ['aspect1', 'aspect2', 'aspect3'].forEach(id => {
                const aspect = document.getElementById(id).value;
                const icon = document.getElementById(id + 'Icon');
                if (aspect && aspectIcons[aspect]) {
                    icon.src = aspectIcons[aspect];
                    icon.style.display = 'block';
                } else {
                    icon.style.display = 'none';
                }
            });
        }

        function updateCharmIcons() {
            ['charm1', 'charm2'].forEach(id => {
                const charm = document.getElementById(id).value;
                const icon = document.getElementById(id + 'Icon');
                if (charm && charmIcons[charm]) {
                    icon.src = charmIcons[charm];
                    icon.style.display = 'block';
                } else {
                    icon.style.display = 'none';
                }
            });
        }

        function updateAspectOptions() {
            const aspect1 = document.getElementById('aspect1').value;
            const aspect2 = document.getElementById('aspect2').value;
            const aspect3 = document.getElementById('aspect3').value;
            
            const selectedAspects = [aspect1, aspect2, aspect3].filter(a => a !== '');
            
            const aspectSelects = ['aspect1', 'aspect2', 'aspect3'];
            aspectSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                const options = select.querySelectorAll('option');
                options.forEach(option => {
                    if (option.value !== '' && selectedAspects.includes(option.value) && select.value !== option.value) {
                        option.disabled = true;
                    } else {
                        option.disabled = false;
                    }
                });
            });
        }

        function updateCharmOptions() {
            const charm1 = document.getElementById('charm1').value;
            const charm2 = document.getElementById('charm2').value;
            
            const selectedCharms = [charm1, charm2].filter(c => c !== '');
            
            const charmSelects = ['charm1', 'charm2'];
            charmSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                const options = select.querySelectorAll('option');
                options.forEach(option => {
                    if (option.value !== '' && selectedCharms.includes(option.value) && select.value !== option.value) {
                        option.disabled = true;
                    } else {
                        option.disabled = false;
                    }
                });
            });
        }

        async function addBuild() {
            const submitBtn = document.getElementById('submitBtn');
            const errorMsg = document.getElementById('errorMessage');
            
            try {
                submitBtn.disabled = true;
                submitBtn.textContent = 'Creating...';
                errorMsg.style.display = 'none';

                const buildName = document.getElementById('buildName').value || 'Untitled Build';
                const authorName = document.getElementById('authorName').value || 'Anonymous';
                const weapon = document.getElementById('weaponSelect').value;
                const ability = document.getElementById('abilitySelect').value;
                const primary = document.getElementById('primarySelect').value;
                const secondary = document.getElementById('secondarySelect').value;
                const aspect1 = document.getElementById('aspect1').value;
                const aspect2 = document.getElementById('aspect2').value;
                const aspect3 = document.getElementById('aspect3').value;
                const weaponForge1 = document.getElementById('weaponForge1').value;
                const weaponForge2 = document.getElementById('weaponForge2').value;
                const weaponForge3 = document.getElementById('weaponForge3').value;
                const abilityForge1 = document.getElementById('abilityForge1').value;
                const abilityForge2 = document.getElementById('abilityForge2').value;
                const abilityForge3 = document.getElementById('abilityForge3').value;
                const charm1 = document.getElementById('charm1').value;
                const charm2 = document.getElementById('charm2').value;
                const description = document.getElementById('description').value || 'No description provided.';

                const build = {
                    buildname: buildName,
                    author: authorName,
                    weapon: weapon,
                    ability: ability,
                    primary: primary,
                    secondary: secondary,
                    aspect1: aspect1,
                    aspect2: aspect2,
                    aspect3: aspect3,
                    weaponforge1: weaponForge1,
                    weaponforge2: weaponForge2,
                    weaponforge3: weaponForge3,
                    abilityforge1: abilityForge1,
                    abilityforge2: abilityForge2,
                    abilityforge3: abilityForge3,
                    charm1: charm1,
                    charm2: charm2,
                    description: description,
                    date: new Date().toISOString(),
                    likes: 0
                };

                await window.firestore.addDoc(window.firestore.collection(window.db, 'builds'), build);

                document.getElementById('successMessage').style.display = 'block';
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1500);
            } catch (error) {
                console.error('Error adding build:', error);
                errorMsg.textContent = 'Error creating build: ' + error.message;
                errorMsg.style.display = 'block';
                submitBtn.disabled = false;
                submitBtn.textContent = 'Add Build';
            }
        }
        </script>
</body>
</html>

